<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/table.css">
    <title>DNS over HTTPS with JSON API</title>
</head>

<body>
    <form action="" onsubmit="return false">
        <div>
            <label for="name">FQDN</label>
            <input type="text" name="name" id="name">
        </div>
        <div>
            <label for="type">Type</label>
            <input list="typeset" id="type" name="type" value="ANY">
            <datalist id="typeset">
                <option value="ANY"></option>
                <option value="A"></option>
                <option value="AAAA"></option>
                <option value="AFSDB"></option>
                <option value="APL"></option>
                <option value="CAA"></option>
                <option value="CDNSKEY"></option>
                <option value="CDS"></option>
                <option value="CERT"></option>
                <option value="CNAME"></option>
                <option value="DHCID"></option>
                <option value="DLV"></option>
                <option value="DNAME"></option>
                <option value="DNSKEY"></option>
                <option value="DS"></option>
                <option value="HIP"></option>
                <option value="HTTPS"></option>
                <option value="IPSECKEY"></option>
                <option value="KEY"></option>
                <option value="KEY"></option>
                <option value="KX"></option>
                <option value="LOC"></option>
                <option value="MX"></option>
                <option value="NAPTR"></option>
                <option value="NS"></option>
                <option value="NSEC"></option>
                <option value="NSEC3"></option>
                <option value="NSEC3PARAM"></option>
                <option value="PTR"></option>
                <option value="RRSIG"></option>
                <option value="RP"></option>
                <option value="SIG"></option>
                <option value="SOA"></option>
                <option value="SRV"></option>
                <option value="SSHFP"></option>
                <option value="SVCB"></option>
                <option value="TA"></option>
                <option value="TKEY"></option>
                <option value="TLSA"></option>
                <option value="TSIG"></option>
                <option value="TXT"></option>
                <option value="AXFR"></option>
                <option value="IXFR"></option>
                <option value="OPT"></option>
            </datalist>
        </div>
        <input type="submit" value="Query" onclick="q()">
    </form>
    <br />
    <div>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>TTL</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody id="result"></tbody>
        </table>
    </div>
    <script>
        const typeCnv = {
            1: 'A',
            28: 'AAAA',
            18: 'AFSDB',
            42: 'APL',
            257: 'CAA',
            60: 'CDNSKEY',
            59: 'CDS',
            37: 'CERT',
            5: 'CNAME',
            49: 'DHCID',
            32769: 'DLV',
            39: 'DNAME',
            48: 'DNSKEY',
            43: 'DS',
            55: 'HIP',
            65: 'HTTPS',
            45: 'IPSECKEY',
            25: 'KEY',
            36: 'KX',
            29: 'LOC',
            15: 'MX',
            35: 'NAPTR',
            2: 'NS',
            47: 'NSEC',
            50: 'NSEC3',
            51: 'NSEC3PARAM',
            12: 'PTR',
            46: 'RRSIG',
            17: 'RP',
            24: 'SIG',
            6: 'SOA',
            33: 'SRV',
            44: 'SSHFP',
            64: 'SVCB',
            32768: 'TA',
            249: 'TKEY',
            52: 'TLSA',
            250: 'TSIG',
            16: 'TXT',
            252: 'AXFR',
            251: 'IXFR',
            41: 'OPT',
        };
        const reshold = document.getElementById('result');
        function q() {
            const param = new URLSearchParams({
                name: document.getElementsByName('name')[0].value,
                type: document.getElementsByName('type')[0].value,
            });

            fetch('https://dns.google/resolve?' + param.toString())
                .then((d) => d.json())
                .then((i) => {
                    const ans = i['Answer'];
                    reshold.innerHTML = '';
                    ans.forEach(e => {
                        const tr = document.createElement('tr');

                        let td_nm = document.createElement('td');
                        td_nm.innerText = e['name'];
                        tr.appendChild(td_nm);
                        let td_ty = document.createElement('td');
                        td_ty.innerText = typeCnv[e['type']];
                        tr.appendChild(td_ty);
                        let td_ttl = document.createElement('td');
                        td_ttl.innerText = e['TTL'];
                        tr.appendChild(td_ttl);
                        let td_dt = document.createElement('td');
                        td_dt.innerText = e['data'];
                        tr.appendChild(td_dt);

                        reshold.appendChild(tr);
                    });
                });
        }
    </script>
</body>

</html>